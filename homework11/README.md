# CDN 
 
## Run docker 
`docker-compose up` 

## Configure 
### Change to or add to list DSN with IP 192.168.55.2
```
sudo vi /etc/resolv.con
# file content
# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateResolvConf = false
nameserver 192.168.55.2
```

### Change config in file bind/bind/etc/named.conf.local
Default: matched clients by IP rules
```
#from 192.168.55.0 to 192.168.55.127
match-clients { 192.168.55.0/25; };
```

GeoIP: matched clients by IP geo position (UA)
```
#comment line
#match-clients { 192.168.55.0/25; };
    
#uncoment line
match-clients { UA; };
```

## Test cases
### IPs range or IPs from UA region
```
docker-compose exec test_zone_UA bash

for i in `seq 1 6`; do curl www.condelnet.com; echo "************************"; done
```

Result:
```
<!DOCTYPE html>
<html>
<body>

<h1>UA</h1>
<h1>Host1</h1>

</body>
</html>
----------------------
<!DOCTYPE html>
<html>
<body>

<h1>UA</h1>
<h1>Host2</h1>

</body>
</html>
----------------------
<!DOCTYPE html>
<html>
<body>

<h1>UA</h1>
<h1>Host1</h1>

</body>
</html>
----------------------
<!DOCTYPE html>
<html>
<body>

<h1>UA</h1>
<h1>Host2</h1>

</body>
</html>
----------------------
<!DOCTYPE html>
<html>
<body>

<h1>UA</h1>
<h1>Host1</h1>

</body>
</html>
----------------------
<!DOCTYPE html>
<html>
<body>

<h1>UA</h1>
<h1>Host2</h1>

</body>
</html>
----------------------
```

Docker-compose log:
```
load-balancer-1_1  | 192.168.55.15 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.1" 200 75 "-" "curl/7.74.0" "-"
web-1_1            | 192.168.55.3 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.0" 200 75 "-" "curl/7.74.0" "-"
load-balancer-1_1  | 192.168.55.15 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.1" 200 75 "-" "curl/7.74.0" "-"
web-2_1            | 192.168.55.3 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.0" 200 75 "-" "curl/7.74.0" "-"
load-balancer-1_1  | 192.168.55.15 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.1" 200 75 "-" "curl/7.74.0" "-"
web-1_1            | 192.168.55.3 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.0" 200 75 "-" "curl/7.74.0" "-"
load-balancer-1_1  | 192.168.55.15 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.1" 200 75 "-" "curl/7.74.0" "-"
web-2_1            | 192.168.55.3 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.0" 200 75 "-" "curl/7.74.0" "-"
load-balancer-1_1  | 192.168.55.15 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.1" 200 75 "-" "curl/7.74.0" "-"
web-1_1            | 192.168.55.3 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.0" 200 75 "-" "curl/7.74.0" "-"
load-balancer-1_1  | 192.168.55.15 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.1" 200 75 "-" "curl/7.74.0" "-"
web-2_1            | 192.168.55.3 - - [25/Dec/2022:23:05:33 +0000] "GET / HTTP/1.0" 200 75 "-" "curl/7.74.0" "-"
```


### Other IPs or World except UA region
```
docker-compose exec test_zone_WORLD bash

for i in `seq 1 8`; do curl www.condelnet.com; echo "************************"; done
```

Result:
```
<!DOCTYPE html>
<html>
<body>

<h1>World</h1>
<h1>Host1</h1>

</body>
</html>
************************
<!DOCTYPE html>
<html>
<body>

<h1>World</h1>
<h1>Host1</h1>

</body>
</html>
************************
<!DOCTYPE html>
<html>
<body>

<h1>World</h1>
<h1>Host1</h1>

</body>
</html>
************************
<!DOCTYPE html>
<html>
<body>

<h1>World</h1>
<h1>Host2</h1>

</body>
</html>
************************
<!DOCTYPE html>
<html>
<body>

<h1>World</h1>
<h1>Host1</h1>

</body>
</html>
************************
<!DOCTYPE html>
<html>
<body>

<h1>World</h1>
<h1>Host1</h1>

</body>
</html>
************************
<!DOCTYPE html>
<html>
<body>

<h1>World</h1>
<h1>Host1</h1>

</body>
</html>
************************
<!DOCTYPE html>
<html>
<body>

<h1>World</h1>
<h1>Host2</h1>

</body>
</html>
************************
```

Docker-compose log:
```
load-balancer-2_1  | 192.168.55.150 - - [13/Oct/2022:14:00:51 +0000] "GET / HTTP/1.1" 200 78 "-" "curl/7.74.0" "-"
load-balancer-2_1  | 192.168.55.150 - - [13/Oct/2022:14:00:51 +0000] "GET / HTTP/1.1" 200 78 "-" "curl/7.74.0" "-"
web-3_1            | 192.168.55.4 - - [13/Oct/2022:14:00:51 +0000] "GET / HTTP/1.0" 200 78 "-" "curl/7.74.0" "-"
web-3_1            | 192.168.55.4 - - [13/Oct/2022:14:00:51 +0000] "GET / HTTP/1.0" 200 78 "-" "curl/7.74.0" "-"
load-balancer-2_1  | 192.168.55.150 - - [13/Oct/2022:14:00:51 +0000] "GET / HTTP/1.1" 200 78 "-" "curl/7.74.0" "-"
web-3_1            | 192.168.55.4 - - [13/Oct/2022:14:00:51 +0000] "GET / HTTP/1.0" 200 78 "-" "curl/7.74.0" "-"
load-balancer-2_1  | 192.168.55.150 - - [13/Oct/2022:14:00:51 +0000] "GET / HTTP/1.1" 200 78 "-" "curl/7.74.0" "-"
web-4_1            | 192.168.55.4 - - [25/Dec/2022:23:50:33 +0000] "GET / HTTP/1.0" 200 78 "-" "curl/7.74.0" "-"
load-balancer-2_1  | 192.168.55.150 - - [25/Dec/2022:23:50:33 +0000] "GET / HTTP/1.1" 200 78 "-" "curl/7.74.0" "-"
web-3_1            | 192.168.55.4 - - [25/Dec/2022:23:50:33 +0000] "GET / HTTP/1.0" 200 78 "-" "curl/7.74.0" "-"
load-balancer-2_1  | 192.168.55.150 - - [25/Dec/2022:23:50:33 +0000] "GET / HTTP/1.1" 200 78 "-" "curl/7.74.0" "-"
web-3_1            | 192.168.55.4 - - [25/Dec/2022:23:50:33 +0000] "GET / HTTP/1.0" 200 78 "-" "curl/7.74.0" "-"
load-balancer-2_1  | 192.168.55.150 - - [25/Dec/2022:23:50:33 +0000] "GET / HTTP/1.1" 200 78 "-" "curl/7.74.0" "-"
web-3_1            | 192.168.55.4 - - [25/Dec/2022:23:50:33 +0000] "GET / HTTP/1.0" 200 78 "-" "curl/7.74.0" "-"
load-balancer-2_1  | 192.168.55.150 - - [25/Dec/2022:23:50:33 +0000] "GET / HTTP/1.1" 200 78 "-" "curl/7.74.0" "-"
load-balancer-2_1  | 192.168.55.150 - - [25/Dec/2022:23:50:33 +0000] "GET / HTTP/1.1" 200 78 "-" "curl/7.74.0" "-"
web-4_1            | 192.168.55.4 - - [25/Dec/2022:23:50:33 +0000] "GET / HTTP/1.0" 200 78 "-" "curl/7.74.0" "-"
```